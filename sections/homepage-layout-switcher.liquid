{% comment %}
  Homepage Layout Switcher for Project-Dream theme
  Allows users to switch between single product and multi-product homepage layouts
{% endcomment %}

<div class="layout-switcher" data-layout-switcher>
  <div class="layout-switcher__container">
    <h3 class="layout-switcher__title">{{ section.settings.title | default: 'Homepage Layout' }}</h3>
    
    <div class="layout-switcher__options">
      <button 
        class="layout-switcher__option{% if section.settings.current_layout == 'single-product' %} layout-switcher__option--active{% endif %}"
        data-layout="single-product"
        data-template="/templates/index.single-product.json"
      >
        <div class="layout-switcher__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" fill="none"/>
            <rect x="6" y="6" width="12" height="8" rx="1" fill="currentColor"/>
            <line x1="6" y1="16" x2="10" y2="16" stroke="currentColor"/>
            <line x1="6" y1="18" x2="8" y2="18" stroke="currentColor"/>
          </svg>
        </div>
        <div class="layout-switcher__content">
          <span class="layout-switcher__name">{{ section.settings.single_product_label | default: 'Single Product' }}</span>
          <span class="layout-switcher__description">{{ section.settings.single_product_description | default: 'Focus on one hero product' }}</span>
        </div>
      </button>

      <button 
        class="layout-switcher__option{% if section.settings.current_layout == 'multi-product' %} layout-switcher__option--active{% endif %}"
        data-layout="multi-product"
        data-template="/templates/index.multi-product.json"
      >
        <div class="layout-switcher__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" fill="none"/>
            <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" fill="none"/>
            <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" fill="none"/>
            <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor" fill="none"/>
          </svg>
        </div>
        <div class="layout-switcher__content">
          <span class="layout-switcher__name">{{ section.settings.multi_product_label | default: 'Multi Product' }}</span>
          <span class="layout-switcher__description">{{ section.settings.multi_product_description | default: 'Showcase product collections' }}</span>
        </div>
      </button>
    </div>

    {% if section.settings.show_preview %}
      <div class="layout-switcher__preview">
        <button class="layout-switcher__preview-btn" data-preview-btn>
          {{ section.settings.preview_button_text | default: 'Preview Layout' }}
        </button>
      </div>
    {% endif %}
  </div>
</div>

{% stylesheet %}
  .layout-switcher {
    background-color: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-lg);
    padding: var(--space-lg);
    position: sticky;
    top: var(--space-lg);
    z-index: var(--z-index-sticky);
  }

  .layout-switcher__container {
    max-width: 100%;
  }

  .layout-switcher__title {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    margin-bottom: var(--space-md);
    text-align: center;
  }

  .layout-switcher__options {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .layout-switcher__option {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md);
    background-color: var(--color-background);
    border: 2px solid var(--color-border);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-align: left;
    width: 100%;
  }

  .layout-switcher__option:hover {
    border-color: var(--color-primary);
    background-color: var(--color-background-secondary);
  }

  .layout-switcher__option--active {
    border-color: var(--color-primary);
    background-color: var(--color-primary);
    color: white;
  }

  .layout-switcher__option--active .layout-switcher__icon,
  .layout-switcher__option--active .layout-switcher__name,
  .layout-switcher__option--active .layout-switcher__description {
    color: white;
  }

  .layout-switcher__icon {
    flex-shrink: 0;
    color: var(--color-primary);
    transition: color var(--transition-fast);
  }

  .layout-switcher__content {
    flex: 1;
  }

  .layout-switcher__name {
    display: block;
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    color: var(--color-foreground);
    margin-bottom: 2px;
    transition: color var(--transition-fast);
  }

  .layout-switcher__description {
    display: block;
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    transition: color var(--transition-fast);
  }

  .layout-switcher__preview {
    margin-top: var(--space-md);
    text-align: center;
  }

  .layout-switcher__preview-btn {
    padding: var(--space-sm) var(--space-md);
    background-color: var(--color-accent);
    color: white;
    border: none;
    border-radius: var(--border-radius);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .layout-switcher__preview-btn:hover {
    background-color: var(--color-primary);
    transform: translateY(-1px);
  }

  /* Mobile adjustments */
  @media (max-width: 768px) {
    .layout-switcher {
      position: static;
      margin-bottom: var(--space-lg);
    }
    
    .layout-switcher__option {
      padding: var(--space-sm);
    }
    
    .layout-switcher__name {
      font-size: var(--font-size-sm);
    }
    
    .layout-switcher__description {
      font-size: var(--font-size-xs);
    }
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const layoutSwitcher = document.querySelector('[data-layout-switcher]');
    
    if (layoutSwitcher) {
      const options = layoutSwitcher.querySelectorAll('.layout-switcher__option');
      const previewBtn = layoutSwitcher.querySelector('[data-preview-btn]');
      
      // Handle layout switching
      options.forEach(option => {
        option.addEventListener('click', function() {
          const layout = this.dataset.layout;
          const template = this.dataset.template;
          
          // Update active state
          options.forEach(opt => opt.classList.remove('layout-switcher__option--active'));
          this.classList.add('layout-switcher__option--active');
          
          // Store selection in localStorage
          localStorage.setItem('preferred_homepage_layout', layout);
          
          // Show confirmation
          const originalText = this.querySelector('.layout-switcher__name').textContent;
          const nameElement = this.querySelector('.layout-switcher__name');
          nameElement.textContent = 'Selected!';
          
          setTimeout(() => {
            nameElement.textContent = originalText;
          }, 1000);
          
          // Trigger custom event for theme integration
          document.dispatchEvent(new CustomEvent('layout:changed', {
            detail: { layout, template }
          }));
        });
      });
      
      // Handle preview button
      if (previewBtn) {
        previewBtn.addEventListener('click', function() {
          const activeOption = layoutSwitcher.querySelector('.layout-switcher__option--active');
          const layout = activeOption?.dataset.layout;
          
          if (layout) {
            // Open preview in new tab/window
            const baseUrl = window.location.origin;
            const previewUrl = layout === 'single-product' 
              ? `${baseUrl}/?template=index.single-product`
              : `${baseUrl}/?template=index.multi-product`;
            
            window.open(previewUrl, '_blank');
          }
        });
      }
      
      // Initialize from localStorage
      const savedLayout = localStorage.getItem('preferred_homepage_layout');
      if (savedLayout) {
        const savedOption = layoutSwitcher.querySelector(`[data-layout="${savedLayout}"]`);
        if (savedOption) {
          options.forEach(opt => opt.classList.remove('layout-switcher__option--active'));
          savedOption.classList.add('layout-switcher__option--active');
        }
      }
    }
  });
{% endjavascript %}

{% schema %}
{
  "name": "Homepage Layout Switcher",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Layout Switcher Settings"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section title",
      "default": "Choose Homepage Layout"
    },
    {
      "type": "select",
      "id": "current_layout",
      "label": "Current active layout",
      "options": [
        {
          "value": "single-product",
          "label": "Single Product"
        },
        {
          "value": "multi-product",
          "label": "Multi Product"
        }
      ],
      "default": "single-product"
    },
    {
      "type": "header",
      "content": "Single Product Layout"
    },
    {
      "type": "text",
      "id": "single_product_label",
      "label": "Single product label",
      "default": "Single Product Focus"
    },
    {
      "type": "text",
      "id": "single_product_description",
      "label": "Single product description",
      "default": "Perfect for dropshipping one hero product"
    },
    {
      "type": "header",
      "content": "Multi Product Layout"
    },
    {
      "type": "text",
      "id": "multi_product_label",
      "label": "Multi product label",
      "default": "Product Collections"
    },
    {
      "type": "text",
      "id": "multi_product_description",
      "label": "Multi product description",
      "default": "Showcase multiple product categories"
    },
    {
      "type": "header",
      "content": "Preview Options"
    },
    {
      "type": "checkbox",
      "id": "show_preview",
      "label": "Show preview button",
      "default": true
    },
    {
      "type": "text",
      "id": "preview_button_text",
      "label": "Preview button text",
      "default": "Preview Layout"
    }
  ],
  "presets": [
    {
      "name": "Homepage Layout Switcher"
    }
  ]
}
{% endschema %}